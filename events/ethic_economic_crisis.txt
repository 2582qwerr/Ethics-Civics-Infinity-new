namespace = ethic_economic_crisis

situation_event = { # 市场经济月度计算协调 这两个事件只有放在这里才能运行
    id = ethic_economic.1
    is_triggered_only = yes
    hide_window = yes
    immediate = {
		situation_event = { id = ethic_economic.11 days = 1 } # 计算情况改善 链式触发六个 11~16
		situation_event = { id = ethic_economic.2 days = 1 } # 计算危机阈值
		if = { # 计算危机增长 - 无危机时
			limit = { NOT = { has_situation_flag = economic_crisis } }
			situation_event = { id = ethic_economic.31 days = 2 } # 链式触发六个 31~36
		}
		else = { # 计算危机增长 - 有危机时
			situation_event = { id = ethic_economic.30 days = 2 }
		}
		situation_event = { id = ethic_economic.4 days = 3 } # 计算危机积累
		situation_event = { id = ethic_economic.5 days = 4 } # 判断经济效果
    }
}
situation_event = { # 经济周期系统介绍
    id = ethic_economic.10
    is_triggered_only = yes
    hide_window = no
	title = ethic_economic.10.name
	desc = ethic_economic.10.desc
	picture = GFX_evt_city_ruins
	option = {
		name = ethic_economic_show_accumulated
	}
	option = {
		name = ethic_economic_not_show_accumulated
		hidden_effect = { owner = { set_country_flag = economic_crisis_unshow } }
	}
	option = {
		name = ethic_economic_close_crisis
		hidden_effect = {
			owner = { set_country_flag = economic_crisis_close }
			destroy_situation = this # 立刻关闭机制
		}
	}
}

situation_event = { # 经济危机：爆发
    id = ethic_economic_crisis.0
    is_triggered_only = yes
    hide_window = no
	title = ethic_economic_crisis.0.name
	desc = ethic_economic_crisis.0.desc
	picture = GFX_evt_city_ruins
    immediate={ add_situation_progress = value:crisis_breakout }
	option = {
		name = OK
	}
}

situation_event = { # 经济危机：最终结束
    id = ethic_economic_crisis.10
    is_triggered_only = yes
	title = ethic_economic_crisis.10.name
	desc = ethic_economic_crisis.10.desc
	picture = GFX_evt_city_ruins
    immediate={
    }
	option = {
		name = OK
	}
}
situation_event = { # 经济危机：暂时结束
    id = ethic_economic_crisis.11
    is_triggered_only = yes
	title = ethic_economic_crisis.11.name
	desc = ethic_economic_crisis.11.desc
	picture = GFX_evt_city_ruins
    immediate={
    }
	option = {
		name = OK
	}
}

# 事件集-经济危机
country_event = {
	id = ethic_economic_crisis.1
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		if = {
			limit = {
				NOT = { has_country_flag = ethic_economic_crisis }
				OR = {
					AND = {
						years_passed < 20
						trade_income > 50
					}
					AND = {
						years_passed > 20
						years_passed < 40
						trade_income > 200
					}
					AND = {
						years_passed > 40
						years_passed < 75
						trade_income > 500
					}
					AND = {
						years_passed > 75
						years_passed < 120
						trade_income > 1000
					}
					AND = {
						years_passed > 120
						trade_income > 1500
					}
				}
			}
			country_event = { id = ethic_economic_crisis.2 }
		}
		else_if = {
			limit = {
				has_country_flag = ethic_economic_crisis
			}
			country_event = { id = ethic_economic_crisis.20 }
		}
	}
}

# 事件集-临近危机
country_event = {
	id = ethic_economic_crisis.2
	title = "ethic_economic_crisis.2.name"
	desc = "ethic_economic_crisis.2.desc"
	picture = GFX_evt_financial_instruments
	show_sound = event_galactic_market

	is_triggered_only = yes

	immediate = {
		#最初波及到的产品
		hidden_effect = {
			random_list = {
				#影响能源
				1 = {
					modifier = {
						factor = 0
						limit = { has_monthly_income = { resource = energy value > 75 }
						}
					}
					set_timed_country_flag = { flag = economic_crisis_10_01 days = 1980 }
				}
				#影响矿物
				1 = {
					modifier = {
						factor = 0
						limit = { has_monthly_income = { resource = minerals value > 75 }
						}
					}
					set_timed_country_flag = { flag = economic_crisis_10_02 days = 1980 }
				}
				#影响食物
				1 = {
					modifier = {
						factor = 0
						limit = { has_monthly_income = { resource = food value > 75 }
						}
					}
					set_timed_country_flag = { flag = economic_crisis_10_03 days = 1980 }
				}
				#影响合金
				1 = {
					modifier = {
						factor = 0
						limit = { has_monthly_income = { resource = alloys value > 35 }
						}
					}
					set_timed_country_flag = { flag = economic_crisis_10_04 days = 1980 }
				}
				#影响消费品
				1 = {
					modifier = {
						factor = 0
						limit = { has_monthly_income = { resource = consumer_goods value > 50 }
						}
					}
					set_timed_country_flag = { flag = economic_crisis_10_05 days = 1980 }
				}
			}
		}
	}

	option = {
		name = ethic_economic_crisis.2.a
		add_modifier = { modifier = economic_crisis_prosperity days = 180 }
		hidden_effect = {
			random_list = {
				3 = {
					modifier = {
						factor = 0
					}
					country_event = { id = ethic_economic_crisis.10 days = 180 }
				}
				7 = { }
			}
		}
	}

	option = {
		name = ethic_economic_crisis.2.b
		trigger = {
			has_policy_flag = economic_stance_planned
			NOT = { has_ethic = ethic_fanatic_egalitarian }
		}
		add_modifier = { modifier = economic_crisis_steady days = 360 }
		every_owned_planet = {
			limit = {
				hidden_trigger = {
					OR = {
						colony_type = col_city
						colony_type = col_habitat_trade
						colony_type = col_ring_trade
						colony_type = col_ecu_mix
						is_capital = yes
					}
				}
			}
			custom_tooltip = is_trade_planet
			add_modifier = {
				modifier = "capitalism_unrest"
				days = 360
			}
		}
	}
}
